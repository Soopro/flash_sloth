<div class="view-animate">
  <div layout-gt-sm="row">
    <!-- column -->
    <section flex-gt-sm="45"
             offset-gt-sm="5"
             layout-padding>
      <!-- section header -->
      <header layout-margin>
        <h2 class="md-display-1 text-nowrap"
            vw-max="80">
          {{promo.meta.title}}
        </h2>
      </header>
      <!-- promo info -->
      <div layout-margin>
        <p>
          {{_('Base Code:')}}
          <span class="text-primary">
            {{promo.base_code}}
          </span>
        </p>
        <p>
          {{_('Type:')}}
          {{promo_type_name(promo.type)}}
        </p>
        <p>
          {{_('Mode:')}}
          {{promo.common?_('Common'):_('Distribution')}}
        </h3>
        <p ng-if="promo.duration != undefined">
          {{_('Remain:')}}
          {{remain(promo.remain)}}
        </p>
        <p ng-if="promo.amount != undefined">
          {{_('Amount:')}}
          {{promo.amount}}
        </p>
        <p ng-if="!promo.common">
          {{_('Reserves:')}}
          {{promo.count.used}} / {{promo.count.total}}
        </p>
        <p ng-if="!promo.common && promo.upper">
          {{_('Point Upper limit:')}}
          {{promo.upper}}
        </p>
        <p>
          {{_('Description:')}}&nbsp;{{promo.meta.description}}
        </p>
      </div>

      <md-content ng-show="promo_loaded && !promo.common">
        <md-tabs md-dynamic-height>
          <md-tab label="{{_('Find')}}"
                  md-on-deselect="reset_code()"
                  md-on-select="switch_gen_mode(false)">
            <!-- find promo code -->
            <div layout-padding>
              <h3 class="md-title">
                {{_('Find Promotion Code')}}
              </h3>
              <form name="find_form"
                    layout="column"
                    ng-submit="find_code()"
                    novalidate>
                <md-input-container>
                  <label>{{_('Code')}}</label>
                  <input name="code"
                         type="text"
                         ng-model="code"
                         required/>
                  <ng-messages ng-if="find_form.code.$touched"
                               for="find_form.code.$error">
                    <ng-message when="required">
                      {{ _('Code is required.') }}
                    </ng-message>
                  </ng-messages>
                </md-input-container>
                <div layout="row"
                     layout-align="space-between">
                  <md-button class="md-raised"
                             type="submit"
                             ng-disabled="submitted">
                    {{_('Find')}}
                  </md-button>
                  <md-button class="md-icon-button"
                             aria-label="{{_('Refresh')}}"
                             ng-disabled="submitted"
                             ng-click="reset_code()">
                    <md-icon md-svg-icon="ic_refresh_24px">
                    </md-icon>
                  </md-button>
                </div>
              </form>
            </div>
          </md-tab>

          <md-tab label="{{_('Create')}}"
                  md-on-select="switch_gen_mode(true)">
            <!-- create promo code -->
            <div layout-padding>
              <h3 class="md-title">
                {{_('Create Promotion Code')}}
              </h3>
              <form name="create_form"
                    layout="column"
                    ng-submit="create()"
                    novalidate>
                <md-input-container>
                  <label>{{_('Assign to Member')}}</label>
                  <input name="member_log"
                         type="text"
                         ng-model="assign_member_log" />
                </md-input-container>
                <div layout="row"
                     layout-align="space-between">
                  <md-button class="md-raised"
                             type="submit"
                             ng-disabled="submitted">
                    {{_('Create')}}
                  </md-button>
                  <md-button class="md-icon-button"
                             aria-label="{{_('Batch')}}"
                             ng-disabled="submitted"
                             ng-click="auto_create()">
                    <md-icon md-svg-icon="ic_android_24px">
                    </md-icon>
                  </md-button>
                </div>
              </form>
            </div>
          </md-tab>
        </md-tabs>
      </md-content>

    </section>


    <!-- column -->
    <section flex-gt-sm="45"
             offset-gt-sm="5"
             ng-show="!gen_mode && promo_loaded"
             layout-padding>
      <!-- section header -->
      <header layout-margin>
        <h2 class="md-display-1 text-nowrap"
            vw-max="80">
          {{_('Use Code')}}
        </h2>
      </header>
      <!-- promo code -->
      <div layout-margin>
        <!-- code card -->
        <md-card class="promo"
                 layout-padding>
          <img ng-src="{{promo.meta.sticker}}"
               ng-show="promo.meta.sticker" />
          <md-icon class="s120"
                   md-svg-icon="ic_local_play_24px"
                   ng-show="!promo.meta.sticker">
          </md-icon>
          <md-card-content ng-show="code_loaded">
            <form name="use_form"
                  layout="column"
                  layout-align="start center"
                  ng-submit="use_code()"
                  novalidate>
              <div class="md-caption text-warn"
                   ng-if="promocode.consumed">
                {{_('Consumed')}}
              </div>
              <div class="md-display-1 text-break">
                  {{promocode.code}}
              </div>
              <div class="md-caption"
                   ng-if="promocode.member_assigned">
                {{_('For Member only')}}
              </div>
              <div class="md-headline"
                   ng-if="promo_type_point(promocode.type)">
                {{promocode.point}} / {{promo.upper}}
              </div>
              <div class="md-title"
                   layout-margin>
                <span class="text-primary"
                      ng-if="promocode._success && !promocode._error">
                  {{_('Success')}}
                </span>
                <span class="text-warn"
                      ng-if="!promocode._success && promocode._error">
                  {{_('Error')}}
                </span>
              </div>

              <div ng-show="promocode.member_assigned"
                   layout-margin>
                <md-input-container>
                  <label>{{_('Member Account ID:')}}</label>
                  <input name="member_log"
                         type="text"
                         ng-model="use_member_log"
                         ng-disabled="promocode.consumed" />
                </md-input-container>
              </div>

              <div ng-show="promo_type_point(promocode.type)"
                   layout-margin>
                <md-input-container>
                  <label>{{_('Point:')}}</label>
                  <input name="point"
                         type="number"
                         ng-model="add_point"
                         ng-disabled="promocode.consumed" />
                </md-input-container>
              </div>

              <div ng-show="promocode.status == 1"
                   layout-margin>
                <md-button class="main-nav-btn md-primary"
                           type="submit"
                           ng-disabled="disable_use()">
                  {{_('Use this code')}}
                </md-button>
              </div>

              <div>
                <p class="md-caption tip">
                  {{promocode.updated | dateformat}}
                </p>
              </div>
            </form>

          </md-card-content>
        </md-card>
      </div>
    </section>

    <!-- column -->
    <section flex-gt-sm="45"
             offset-gt-sm="5"
             ng-show="gen_mode && promo_loaded"
             layout-padding>
      <!-- section header -->
      <header layout-margin>
        <h2 class="md-display-1 text-nowrap"
            vw-max="80">
          {{_('Generated Codes')}}
        </h2>
      </header>
      <!-- promo code -->
      <div layout-margin>
        <md-list>
          <md-subheader class="md-no-sticky">
            <span ng-bind-html="_('You have <span class=text-primary>'+
             '%s</span> codes, <span class=text-primary>%s</span> '+
              'have been used', promo.count.total, promo.count.used)">
            </span>
          </md-subheader>
          <md-divider></md-divider>
          <!-- items -->
          <div class="anim-item"
               ng-repeat="code in new_codes">
            <md-list-item class="md-2-line">
              <div class="md-list-item-text"
                   layout="column">
                <h3 class="text-break">
                  {{ code.code }}
                </h3>
                <p class="text-break"
                   ng-if="code.member_log">
                  {{ code.member_log}}
                </p>
              </div>
              <md-icon md-svg-icon="ic_local_play_24px"
                       ng-if="!code.member_assigned">
              </md-icon>
              <md-icon class="md-accent"
                       md-svg-icon="ic_people_24px"
                       ng-if="code.member_assigned">
              </md-icon>
            </md-list-item>
          </div>
        </md-list>
      </div>
    </section>
  </div>
</div>